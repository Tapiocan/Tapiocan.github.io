<!DOCTYPE html>
<html>

<head>
	<title>Tornados en Estados Unidos</title>
	<script src="https://cdn.plot.ly/plotly-2.34.0.min.js"></script>
	<link rel="stylesheet" href="style.css">
</head>

<body>
	<div class="div_titulo">
		<h1>Número de fallecidos por tornados en EEUU</h1>
	</div>

	<div id="myMapContainer" style="position: relative; width: 100%; height: 600px;">
		<!-- Gráfico -->
		<div id="myMap" style="width: 100%; height: 100%;"></div>
	
		<!-- Imagen sobrepuesta al gráfico -->
		<img id="context" src="map.svg" />
	</div>
	

	<script>
	fetch('fallecidos_por_estado.json').then(response => response.json()).then(datos => {
			const estados = datos.map(item => item.estado);
			const nombre_estados = ['Alaska', 'Alabama', 'Arkansas', 'Arizona', 'California', 'Colorado', 'Connecticut', 'Distrito de Columbia', 'Delaware', 'Florida', 'Georgia', 'Hawái', 'Iowa', 'Idaho', 'Illinois', 'Indiana', 'Kansas', 'Kentucky', 'Luisiana', 'Massachusetts', 'Maryland', 'Maine', 'Míchigan', 'Minnesota', 'Misuri', 'Misisipi', 'Montana', 'Carolina del Norte', 'Dakota del Norte', 'Nebraska', 'Nuevo Hampshire', 'Nueva Jersey', 'Nuevo México', 'Nevada', 'Nueva York', 'Ohio', 'Oklahoma', 'Oregón', 'Pensilvania', 'Puerto Rico', 'Rhode Island', 'Carolina del Sur', 'Dakota del Sur', 'Tennessee', 'Texas', 'Utah', 'Virginia', 'Islas Vírgenes', 'Vermont', 'Washington', 'Wisconsin', 'Virginia Occidental', 'Wyoming']
			const fallecidosPorMillon = datos.map(item => {
				const fallecidos = item['núm de fallecidos'];
				const poblacion = item['población'];
				return ((fallecidos / poblacion) * 1000000).toFixed(2); // Resultado por millón de habitantes
			});
	
			const data = [{
				type: 'choropleth',
				locationmode: 'USA-states', 
				locations: estados,
				z: fallecidosPorMillon, 
				text: nombre_estados,
				color_continuous_scale: "Viridis", 
				colorbar: {
					title: {
						text: 'Número de fallecidos<br>por millón de<br>habitantes' 
					}
				}
			}];
	
			const layout = {
				geo: {
					scope: 'usa',
					showlakes: true,
					lakecolor: 'rgb(255, 255, 255)',
				},
				dragmode: false,
				annotations: []
			};
	
			Plotly.newPlot('myMap', data, layout, { scrollZoom: false, displayModeBar: false, staticPlot: false });
			window.onresize = function() {
				Plotly.Plots.resize('myMap');
			};

			let timeout;

		const audio = new Audio("audio_tornado.mp3");

		document.getElementById('myMap').on('plotly_click', function(data) {
		const estado = data.points[0].location;

		const muertesPorMillon = data.points[0].z;

		const volumen = Math.max(0, Math.min(1, muertesPorMillon /200));

		audio.volume = volumen;
		audio.currentTime = 0;

		audio.play();
		clearTimeout(timeout);
		timeout = setTimeout(() => {
			audio.pause();
		}, 16000);
	})
			
    });

	

	</script>

</body>

</html>